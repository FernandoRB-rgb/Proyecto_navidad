function initRegister(e){let t="popup"==$("#submitButton").data("popup")?1:0,r=$("#registerForm").attr("attr-data-section")??"register";e.addEventListener("submit",function(e){e.preventDefault(),hideAllErrors();e=checkParams();e&&e.username&&e.email&&e.password&&(document.getElementById("submitButton").disabled=!0,doFetch("/ajax/userRegister",e).then(e=>{if(e.ok)return e.json();throw document.getElementById("submitButton").disabled=!1,new Error("Error fetching items")}).then(e=>{e.errors&&(document.getElementById("submitButton").disabled=!1,e.errors.forEach(e=>{showError(mappedError(e.error_code),e.message)})),e.user.location&&(setCookie("userName",e?.user?.user_name,86400),setCookie("userHash",e?.user?.hash,86400),setCookie("userPass",e?.user?.password,86400),setCookie("userAvatar",e?.user?.avatar,86400),setCookie("userEmail",e?.user?.email,86400),setCookie("userId",e?.user?.id,86400),document.getElementById("register").classList.add("hidden"),document.getElementById("successfulRegister").classList.remove("hidden"),setTimeout(()=>{"payment"===r?window.location="/payment/pay":t?window.location=window.location.href:window.location.href=e.user.location},1500))}))})}function checkParams(){var e={};e.csrf_token=document.getElementById("csrf_token").value;let t=document.getElementById("user").value;t=t.toLowerCase();var r=document.getElementById("email").value,o=document.getElementById("emailConfirm").value,s=document.getElementById("pass").value,n=document.getElementById("confirmPassword").value;return null!==new RegExp("(?!.*[\\_]{2,})^[a-z0-9\\_.]{4,16}$").exec(t)?e.username=t:showError("badUserName"),r===o?e.email=r:showError("badEmail"),s===n?e.password=s:showError("badPassword"),e}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("registerForm");e&&initRegister(e)});